# ðŸ’¬ **Master-Prompt fÃ¼r die Weiterentwicklung von â€žWeddingPixâ€œ**

*(der ausfÃ¼hrlichste, zusammenhÃ¤ngende Auftrag â€“ direkt an einen Entwickler/Freelancer adressiert)*

---

## 0 Â· **Einstieg â€“ Projekt zuerst vollstÃ¤ndig verstehen**

1. **Repository klonen**

   ```bash
   git clone https://github.com/syqdur/weddingpix.git
   cd weddingpix
   npm i        # oder: pnpm i / yarn
   npm run dev  # lokaler Start via Vite
   ```

2. **Quellcode scannen & lernen**

   * Lies **`README.md`** + **`README_SPOTIFY_SETUP.md`**.
   * PrÃ¼fe Struktur: `src/`, `public/`, `docs/`, `components/`, `services/`.
   * Ã–ffne **`src/App.tsx`** und verstehe das komplette UI-Konzept
     (Timeline-Grid, Spotify-Einbettung, Recap-Balken, Tailwind-Layout).
   * Notiere, welche Teile statisch/hard-coded sind und welche bereits dynamisch.

3. **Ergebnis deines Scans**

   * Erstelle ein kurzes Architecture-Diagramm (optional mermaid oder markdown).
   * Liste vorhandene Features (Spotify-OAuth, Timeline-Anzeige, Dankeskarten, Recap-Player).
   * Liste alle fehlenden Features, die fÃ¼r Multi-User-Betrieb notwendig sind
     (Auth, Galerie-Isolation, Firestore-Queries, Storage-Uploads etc.).

---

## 1 Â· **Projektziel (Business & Technik)**

> **WeddingPix** wird von einer Single-User-Demo zu einer **geschÃ¤ftsfÃ¤higen Multi-User-Galerieplattform** ausgebaut.
> Nach Registrierung erhÃ¤lt jeder Nutzer **eine vollkommen isolierte Galerie** mit eigenem Link, in die er Fotos, Videos, Stories hochlÃ¤dt, Spotify-Playlists einbettet und Recap-Videos generiert â€“ alles im bestehenden Tailwind-Design von `App.tsx`.

---

## 2 Â· **Tech-Stack (Soll-Architektur)**

| Ebene               | LÃ¶sung / Framework                                          |
| ------------------- | ----------------------------------------------------------- |
| Frontend            | React 18 + Vite + TypeScript + Tailwind                     |
| Auth + DB + Storage | **Firebase** (Auth, Firestore, Storage, optional Functions) |
| Hosting FE          | Netlify (bereits eingerichtet)                              |
| Analytics           | Firebase Analytics                                          |
| Musik               | Spotify Web API + OAuth2                                    |

---

## 3 Â· **Firebase-Integration (verbindlich implementieren)**

### 3.1 Pakete installieren

```bash
npm i firebase         # runtime-SDK
# optionale Typen & Helpers
npm i -D @firebase/firestore @firebase/storage
```

### 3.2 Environment-Variablen (`.env.local` + `.env.example`)

```env
VITE_FIREBASE_API_KEY=AIzaSyCqDlIxPDp-QU6mzthkWnmzM6rZ8rnJdiI
VITE_FIREBASE_AUTH_DOMAIN=dev1-b3973.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=dev1-b3973
VITE_FIREBASE_STORAGE_BUCKET=dev1-b3973.appspot.com     # â† Domainfix
VITE_FIREBASE_MESSAGING_SENDER_ID=658150387877
VITE_FIREBASE_APP_ID=1:658150387877:web:ac90e7b1597a45258f5d4c
VITE_FIREBASE_MEASUREMENT_ID=G-7W2BNH8MQ7
```

### 3.3 Zentrale Initialisierung (`src/lib/firebase.ts`)

```ts
import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';
import { getStorage } from 'firebase/storage';
import { getAnalytics, isSupported } from 'firebase/analytics';

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID,
  measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID,
};

const app       = initializeApp(firebaseConfig);
export const auth     = getAuth(app);
export const db       = getFirestore(app);
export const storage  = getStorage(app);

isSupported().then(ok => ok && getAnalytics(app));
```

### 3.4 Storage-Regeln (`storage.rules`)

```bash
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Medien pro Nutzer
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    // Galerie-Assets pro Nutzer
    match /galleries/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

### 3.5 Firestore-Regeln (`firestore.rules`)

```bash
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;
      allow create: if request.auth != null;     // erstes Anlegen
    }

    match /galleries/{userId}/{doc=**} {
      allow read, write: if request.auth.uid == userId;
    }
  }
}
```

### 3.6 Auth-Hooks (Beispiel)

```ts
// src/hooks/useAuth.ts
import { onAuthStateChanged } from 'firebase/auth';
import { useEffect, useState } from 'react';
import { auth } from '@/lib/firebase';

export function useAuth() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const unsub = onAuthStateChanged(auth, u => { setUser(u); setLoading(false); });
    return unsub;
  }, []);

  return { user, loading };
}
```

---

## 4 Â· **Datenmodell Firestore (Collections)**

| Collection / Doc                | Felder (Auszug)                                     |
| ------------------------------- | --------------------------------------------------- |
| `users/{uid}`                   | `email`, `displayName`, `createdAt`                 |
| `galleries/{uid}`               | `title`, `theme`, `public`, `coverUrl`              |
| `galleries/{uid}/media/{mid}`   | `type` (photo/video), `url`, `createdAt`, `caption` |
| `galleries/{uid}/stories/{sid}` | `url`, `expiresAt`, `thumbUrl`                      |
| `galleries/{uid}/recaps/{rid}`  | `videoUrl`, `createdAt`, `songTitle`                |
| `spotify_tokens/{uid}`          | `access`, `refresh`, `expiresAt`                    |

---

## 5 Â· **Feature-Roadmap (Sprint-PrioritÃ¤t)**

| Sprint | Deliverable                              | Kern-Tasks                                                                                   |
| ------ | ---------------------------------------- | -------------------------------------------------------------------------------------------- |
| **01** | **Auth-MVP + PrivateRoute**              | Signup, Login, Logout UI Â· Firestore `users` Doc Â· `/gallery/:uid` private Route             |
| **02** | **Galerie-Isolation**                    | Firestore `galleries` Doc anlegen beim Signup Â· Default-Gallery-View dynamisch aus `App.tsx` |
| **03** | **Media-Upload**                         | Uploader (Drag & Drop) â†’ Storage `/users/{uid}/â€¦` Â· Firestore-Media-Entry Â· Timeline-Query   |
| **04** | **Spotify-pro-User**                     | OAuth-Flow pro Nutzer Â· Token-Save Â· Einbettung in Galerie                                   |
| **05** | **Stories**                              | Ablauf-Logik 24 h Â· UI-Carousel                                                              |
| **06** | **Recap-Generator**                      | Auswahl-Wizard, Render-Pipeline (ffmpeg-Cloud / client-side)                                 |
| **07** | **Ã–ffentliche Galerie + Passwortschutz** | Toggle in `galleries` Doc Â· Public Route `/p/:uid`                                           |
| **08** | **Admin-Panel & CI/CD**                  | Ãœbersicht Nutzer / Speicher Â· Netlify build hook Â· Tests                                     |

---

## 6 Â· **Design-Guidelines**

* **Nutze 100 % das bestehende Tailwind-Layout** von `App.tsx`.
* Bewahre Farben, Shadow-Stufen, Animations-Timing.
* Passe nur an, wenn nÃ¶tig (bspw. Login-Form, Uploader-DragArea).
* Responsives Verhalten â‰¥ 320 px sicherstellen.

---

## 7 Â· **Akzeptanzkriterien je Feature**

1. **Login/Signup**: Neuregistrierter User landet auf leerer, persÃ¶nlichen Galerie â†’ URL `/gallery/<uid>` und sieht â€žNoch keine Medienâ€œ-Placeholder.
2. **Isolation**: Auth-User A kann `/gallery/uid-B` nicht aufrufen (Redirect â†’ 404 / login).
3. **Upload**: Nach Upload wird Medium sofort in Timeline angezeigt; File liegt im Storage-Pfad `/users/<uid>/â€¦`.
4. **Spotify**: Nach Verbinden erscheint eingebettete Playlist; Token-Refresh nach Ablauf funktioniert.
5. **Story**: Ablauf nach 24 h; abgelaufene Stories werden in Firestore gelÃ¶scht oder mit `expired:true` markiert.
6. **Recap**: Wizard erzeugt MP4-URL im Storage, Medienquellen im Firestore-Dokument geloggt.

---

## 8 Â· **Kommunikation & Doku**

* **Commits** in Englisch, PrÃ¤fix Conventional Commits (`feat:`, `fix:`, `chore:`).
* **Notion / README**-Abschnitt pro Sprint mit technischen Entscheidungen.
* **Environment-Secrets** NIEMALS committen.

---

### ðŸš€ **Los gehtâ€™s!**

1. **Scan & Report** des aktuellen Codes abschlieÃŸen (1 Tag).
2. **Sprint 01 (Auth-MVP)** starten und als Pull-Request liefern.
3. Nach Review gemeinsam die nÃ¤chsten Sprints freigeben.

> **Fragen?** â€” Melde dich jederzeit mit Roadblocks oder Architektur-Entscheidungen.
> **Ziel:** Release-fÃ¤hige Public-Beta in â‰ˆ 6â€“8 Wochen.
